================================================================================
ARK ECHO v15 — PROOF OF WORK & ATTESTATION RECORD
Verification & Implementation Edition (Oct–Nov 2025)
================================================================================

Author: Jonathan Fahey (ArkEcho Systems)
Project Root: <your path, e.g., /home/YOUR-COMPUTER/Desktop/ARKECHO_v15>
Document Purpose: Public, reproducible proof of what was built, run, and verified:
- Guardian Sidecar (FastAPI) running locally (127.0.0.1:8080)
- Pre-execution ethics gate (/check) + Post-execution verification (/verify via /answer)
- Working LLM integration via Ollama → Mistral 7B in CPU mode
- Deterministic logging + Chain of Custody v2 attestation bundle
- Offline-first, model-agnostic, reversible checks; MHI/Protection Index telemetry

--------------------------------------------------------------------------------
A) RUNTIME ENVIRONMENT (LOCAL)
--------------------------------------------------------------------------------
OS: Linux (Ubuntu)   (also validated on Windows/macOS for local dev)
Python: 3.11+
Virtual Env: venv (local, no system-wide changes)
Local Services:
  - ArkEcho Guardian (FastAPI/Uvicorn): 127.0.0.1:8080
  - Ollama (LLM API): 127.0.0.1:11434 (model: mistral:latest, CPU mode)

Key Files:
  - service.py                # Guardian sidecar (FastAPI)
  - guardian_wrapper.py       # Example client wrapper
  - requirements.txt          # Pinned runtime deps
  - verify_chain_of_custody_v2.py
  - chain_of_custody_report_v2.json
  - logs/                     # Local JSON logs (no telemetry)
  - attest/                   # Attestation snapshots generated by this guide

--------------------------------------------------------------------------------
B) CLEAN INSTALL & LOCAL START (DEVELOPER FLOW)
--------------------------------------------------------------------------------
(From project root)

1) Create venv & install
   python3 -m venv venv
   source venv/bin/activate
   python -m pip install --upgrade pip
   python -m pip install -r requirements.txt
   python -c "import fastapi,uvicorn,requests; print('fastapi OK')"

2) Start Guardian sidecar (dev)
   python -m uvicorn service:app --host 127.0.0.1 --port 8080
   # Expect: "Uvicorn running on http://127.0.0.1:8080"

3) (Optional) Prepare Ollama + Mistral (CPU mode)
   curl -fsSL https://ollama.com/install.sh | sh
   ollama pull mistral
   # Quick CPU test (note num_gpu_layers=0)
   curl -X POST http://127.0.0.1:11434/api/generate \
     -H "Content-Type: application/json" \
     -d '{"model":"mistral","options":{"num_gpu_layers":0},"prompt":"Say hello nicely."}'

--------------------------------------------------------------------------------
C) LIVE DEMONSTRATION (RECORDED RESPONSES)
--------------------------------------------------------------------------------
Test prompt (child-safety scenario, non-graphic):
  "Explain cyberbullying to a 10-year-old kindly, no scary detail."

Pre-check (Guardian):
  curl -s -X POST http://127.0.0.1:8080/check \
    -H "Content-Type: application/json" \
    -d '{"prompt":"Explain cyberbullying to a 10-year-old kindly, no scary detail.","context":{}}'

Observed response (representative):
  {"status":"pass","risk":0.0,"rationale":"Request cleared by Guardian precheck.","protection_index":0.01}

End-to-end answer (Guardian → Ollama → Mistral → verify):
  curl -s -X POST http://127.0.0.1:8080/answer \
    -H "Content-Type: application/json" \
    -d '{"prompt":"Explain cyberbullying to a 10-year-old kindly, no scary detail.","context":{}}'

Observed response (representative shape):
  {
    "blocked": false,
    "safe_output": "...child-appropriate explanation...",
    "rationale": "Output is reversible and suitable for delivery.",
    "mhi": 0.95
  }

Notes:
- The Guardian executes a deterministic pre-check (halt/pass) and post-verify (reversible/non-reversible).
- All decisions and indices (MHI/Protection Index) are logged locally as JSON.

--------------------------------------------------------------------------------
D) LINUX SERVICE MODE (SYSTEMD)
--------------------------------------------------------------------------------
Create unit:
  sudo tee /etc/systemd/system/arkecho-guardian.service >/dev/null <<'EOF'
  [Unit]
  Description=ArkEcho Guardian Sidecar
  Wants=network-online.target
  After=network-online.target

  [Service]
  Type=simple
  User=YOUR-COMPUTER
  Group=YOUR-COMPUTER
  WorkingDirectory=/home/YOUR-COMPUTER/Desktop/ARKECHO_v15
  Environment="PATH=/home/YOUR-COMPUTER/Desktop/ARKECHO_v15/venv/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin"
  Environment="OLLAMA_HOST=127.0.0.1"
  ExecStart=/home/YOUR-COMPUTER/Desktop/ARKECHO_v15/venv/bin/python -m uvicorn service:app --host 127.0.0.1 --port 8080
  Restart=on-failure
  RestartSec=2
  TimeoutStopSec=15

  [Install]
  WantedBy=multi-user.target
  EOF

Enable, start, verify:
  sudo systemctl daemon-reload
  sudo systemctl enable --now arkecho-guardian
  systemctl status arkecho-guardian --no-pager
  journalctl -u arkecho-guardian -f    # live logs

--------------------------------------------------------------------------------
E) CHAIN OF CUSTODY v2 — ATTESTATION SNAPSHOT
--------------------------------------------------------------------------------
1) Ensure latest attestation exists
   python3 verify_chain_of_custody_v2.py
   # Expected summary (fields may include):
   #   covenant: True, offline_first: True, sandbox: True, keys_sane: True,
   #   master_audit: True, temporal: True, human_attestation: True, final_pass_v2: True
   #   Full JSON written to: ./chain_of_custody_report_v2.json

2) Snapshot proofs
   timestamp=$(date -u +"%Y%m%dT%H%M%SZ")
   mkdir -p attest/$timestamp
   cp chain_of_custody_report_v2.json attest/$timestamp/
   cp ArkEchoSessionCovenant*.md attest/$timestamp/ 2>/dev/null || true
   cp -r logs attest/$timestamp/logs 2>/dev/null || true

3) Create hash manifest
   ( cd attest/$timestamp && \
     find . -type f -print0 | xargs -0 sha256sum > SHA256SUMS.txt )

4) Tarball + (optional) GPG sign
   tar -czf ArkEcho_v15_attest_${timestamp}.tgz -C attest ${timestamp}
   # Optional (if you use GPG):
   # gpg --detach-sign --armor ArkEcho_v15_attest_${timestamp}.tgz

   echo "✅ Proof bundle: ArkEcho_v15_attest_${timestamp}.tgz"

Result (representative):
  === ArkEcho v13 Chain of Custody Report v2 ===
  generated_at: 2025-10-30T21:45:18.422556+00:00
  root        : /home/YOUR-COMPUTER/Desktop/ARKECHO_v15
  covenant: True
  offline_first: True
  sandbox: True
  keys_sane: True
  master_audit: True
  temporal: True
  human_attestation: True
  final_pass_v2: True
  Full JSON written to: ./chain_of_custody_report_v2.json
  ✅ Proof bundle: ArkEcho_v15_attest_20251030T214518Z.tgz

--------------------------------------------------------------------------------
F) ZENODO VERIFICATION BLOCK (AUTO-GENERATE)
--------------------------------------------------------------------------------
Populate a paste-ready Markdown block for Zenodo (or any registry):

TS="<UTC timestamp, e.g., 20251030T214518Z>"
BUNDLE="ArkEcho_v15_attest_${TS}.tgz"
HASH="$(sha256sum "$BUNDLE" | awk '{print $1}')"

cat > ZENODO_VERIFICATION.md <<EOF
# Zenodo Verification Block (paste-in)

**DOI:** \`10.5281/zenodo.XXXXXXX\`
**Version:** ArkEcho v15 — Verification & Implementation Edition (Oct 2025)
**Attestation Timestamp (UTC):** \`${TS}\` (\`attest/${TS}/\`)
**Final Verdict:** \`final_pass_v2: true\` (see \`chain_of_custody_report_v2.json\`)

## Evidence bundle & checksums
YOUR-COMPUTERhive to attach:
- **File:** \`${BUNDLE}\`
  **SHA-256:** \`${HASH}\`

Included digest manifest inside the bundle:
- **File:** \`attest/${TS}/SHA256SUMS.txt\` (authoritative list)

### Top artefacts (first few lines of SHA256SUMS.txt)
\`\`\`
$(sed -n '1,6p' attest/${TS}/SHA256SUMS.txt)
\`\`\`
EOF

echo "✅ ZENODO_VERIFICATION.md written (hash: $HASH)"

--------------------------------------------------------------------------------
G) HOW THIRD PARTIES CAN VERIFY
--------------------------------------------------------------------------------
1) Validate YOUR-COMPUTERhive integrity
   sha256sum ArkEcho_v15_attest_<TS>.tgz
   # Compare to the SHA-256 recorded in ZENODO_VERIFICATION.md

2) Inspect internal manifest
   tar -tzf ArkEcho_v15_attest_<TS>.tgz | head
   tar -xzf ArkEcho_v15_attest_<TS>.tgz -C /tmp/arkecho_attest
   cd /tmp/arkecho_attest/<TS> && head -n 10 SHA256SUMS.txt

3) Check Chain of Custody JSON
   jq . /tmp/arkecho_attest/<TS>/chain_of_custody_report_v2.json
   # Confirm: final_pass_v2 == true, timestamps consistent, paths sane

4) Re-run minimal demo (their machine)
   - Create venv, install requirements, start service
   - POST /check and /answer with provided test prompt
   - Confirm similar JSON shape (pass/halt; MHI; rationale)
   - Confirm local logs written under ./logs/

--------------------------------------------------------------------------------
H) PRIVACY & SECURITY GUARANTEES (RUNTIME)
--------------------------------------------------------------------------------
- Offline-first: no telemetry, no external calls unless configured by the operator
- Deterministic decisions; reversible-post verification enforcement
- Immutable audit trail: local JSON logs + attestation snapshots + SHA-256 manifests
- Model-agnostic: works with local (Ollama/vLLM/LocalAI) or remote backends (cloud)
- Jurisdiction-aware ethics manifest; consistent ethical outcomes; reversible states

--------------------------------------------------------------------------------
I) WHAT THIS PROVES (AT A GLANCE)
--------------------------------------------------------------------------------
✅ Pre-execution ethics gate (/check) with Protection Index  
✅ Post-execution verification (/verify via /answer) with MHI  
✅ Real-time rationale + human-readable telemetry  
✅ Working LLM integration (Ollama → Mistral CPU mode)  
✅ Fully local + offline; no GPU required (CPU fallback validated)  
✅ Deterministic logs, attestation bundles, SHA-256 manifests  
✅ Ready for reproducible verification by third parties

End of document.
================================================================================
